<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-densitydpi" />
    <title>活动项目</title>
    <link rel="stylesheet" href="css/common.css">
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery-jtemplates.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
    <script src="./js/pageCommon.js"></script>

</head>
<style>
</style>
<script>
    $(function(){
        /*页面加载的一些处理*/
        /*隐藏查询条*/
        $("#activitySearchHeader").hide();
        /*切换为查询条件可输入*/
        $("#changeSearch").click(function(){
            $("#activityHeader").hide;
            $("#activitySearchHeader").show();
        });
        var keyWords = "";


        var userPosition ;
        if(localStorage.userPosition){
            userPosition = localStorage.userPosition;
            /*接口调用*/
            po('activity','getactlist',{"KeyWrods":keyWords,"UserPosition":userPosition},"getactlistcallback");
        }else{
            /*获取位置信息*/
            var geolocation = new BMap.Geolocation();
            var userPosition = "116.404|39.915";
            geolocation.getCurrentPosition(function(r){
                if(this.getStatus() == BMAP_STATUS_SUCCESS){
                    //alert('您的位置：'+r.point.lng+','+r.point.lat);
                    userPosition = r.point.lng+"|"+r.point.lat;
                    localStorage.UserPosition = userPosition;
                }
                else {
                    if(localStorage.userPosition){
                        userPosition = "116.404|39.915";
                    }
                }
                /*接口调用*/
                po('activity','getactlist',{"KeyWrods":keyWords,"UserPosition":userPosition},"getactlistcallback");
            },{enableHighAccuracy: true});
        }




        /*页面加载时创建一次jtemplate模板，此后都是给模板赋值*/
        (function createTemplate(){
            // 附上模板
            $("#actlist").setTemplateElement("template");

        })();

        $("#selfBtn").click(function(){
            keyWords = "";
            po('activity','getactlist',{"KeyWrods":keyWords,"UserPosition":userPosition},"getactlistcallback");
        });



        /*筛选按钮点击*/
        $("#search").click(function(){
            keyWords = $("#keyWords").val().trim();
            po('activity','getactlist',{"KeyWrods":keyWords,"UserPosition":userPosition},"getactlistcallback");
        });
    });
    //活动列表回调函数
    function getactlistcallback(d){

//        alert(JSON.stringify(d));
//        alert(KeyWrods+"  "+UserPosition);
        /*d.rd.succ = true;*/

        if(d.rd.succ){

            //活动编码 ActID:’’,//活动标题 Title:’’,//类型 R3:’’,//创建人(社团名) AssName:’’,
            //活动日期,格式YYYY-MM-DD StartDate:’’,//活动时间,格式HH:MM:SS StartTime:’’
            /*var actlist = [];
            for(var n=0;n<9;n++){
                actlist.push({
                    "ActID":n ,//活动编码
                    "Title":"活动标题" ,//活动标题
                    "R3":"运动" ,//类型
                    "AssName":"小明" ,//创建人(社团名)
                    "StartDate":"2014-10-1" ,//活动日期,格式YYYY-MM-DD
                    "StartTime": "22:10:12"//活动时间,格式HH:MM:SS
                });
            }
            d.rd.data.actlist = actlist*/
            var al = d.rd.data.actlist  ;
            //以下采用jtemplates的方式进行模板的拼接
            //循环
            for(var i=0;i<al.length;i++){
                //判断行是奇数还是偶数，并将对应的class写入到json中，供下面绑定模板时候使用
                var style="odd-item";
                if(i%2!=0){
                    style="even-item";
                }
               /* if( al[i]["Title"].length>8){
                    al[i]["Title"] =  al[i]["Title"].substr(0,7)+"..."
                }*/
                al[i]["style"]=style;
                if(!al[i]["StartDate"].trim()){
                    al[i]["StartDate"] = "xx-xx-xx-"
                }
                var dataarr = al[i]["StartDate"].split("-");
                var month =dataarr[0]+"年"+dataarr[1]+"月";
                var day = dataarr[2];
                al[i]["month"] = month;
                al[i]["day"] = day;

                if(!al[i]["StartTime"].trim()){
                    al[i]["StartTime"] = "00:00:00"
                }
                var time = al[i]["StartTime"].substr(0,5);
                al[i]["time"] = time;
            }
            // 给模板加载数据
            $("#actlist").processTemplate(al);
        }else{
            alert(d.rd.msg);
        }
    }
</script>
<body>

    <header id="activityHeader">
        活动项目
        <div class="search">
            <a id="changeSearch"  class="button-icon search-icon"></a><!--href="activity-search.html"-->
        </div>
    </header>
    <header id="activitySearchHeader">

        <div class="right-search">
            <div class="wrap-up">
                <input id="keyWords" placeholder=" 搜索活动">
            </div>
            <div class="wrap-down"></div>
            <div class="fix-search">
                <div><a href="#" id="search" class="button-icon search-icon2"></a></div>
                <div class="fix-search-down"></div>
            </div>

        </div>
    </header>
    <main class="activities">
        <ul id="actlist" class="activity-list">
            <textarea id="template" style="display:none">
                {#foreach $T as record}
            <li class="{$T.record.style}">
                <a href="activity-detail.html?id={$T.record.ActID}">
                    <div class="item-left">
                        <div>
                            <span class="span1">活动标题</span>
                            <span class="title span2"></span>
                        </div>
                        <div style="clear: both"></div>
                        <div>
                            <span></span>
                            <span class="title">{$T.record.Title}</span>
                        </div>
                        <div style="clear: both"></div>
                        <div>
                            <span class="span1">创建人</span>
                            <span class="span2">{$T.record.ShotOrgName}</span>
                        </div>
                        <div style="clear: both"></div>
                    </div>
                    <div class="item-right">
                        <div class="topsp">{$T.record.month}</div>
                        <div class="middlesp"><span class="date">{$T.record.day}</span>日</div>
                        <div class="bottomsp">{$T.record.time}</div>
                    </div>
                </a>
            </li>
                {#/for}
            </textarea>
        </ul>
    </main>
    <footer>
        <ul>
            <li class="side-item"></li>
            <li>
                <a class="selected" id="selfBtn">
                    <span class="button-icon activity-icon"></span>
                </a>
            </li>
            <li>
                <a  href="busines.html">
                    <span class="button-icon business-icon"></span>
                </a>
            </li>
            <li>
                <a  href="selfzoom.html">
                    <span class="button-icon selfzoom-icon"></span>
                </a>
            </li>
            <li class="side-item"></li>
        </ul>
    </footer>
    <script>
        $(function () {
            $(window).scroll(function () {
                $("footer").animate({bottom: "0"}, "fast");
            });
        });
    </script>

</body>
</html>