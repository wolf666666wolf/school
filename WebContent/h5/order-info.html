<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-densitydpi" />
    <title>商品信息</title>
    <link rel="stylesheet" href="css/common.css">
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery-jtemplates.js"></script>
    <script src="./js/pageCommon.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
</head>
<style>

</style>
<script>

    $(function(){
        //页面加载的一些处理
        if(!localStorage.userinfo){
            window.location.href = "bind-mine.html";
        }
        var userInfo = JSON.parse(localStorage.userinfo);
        /*alert(getParameter("id"))*/
        var OrderInfo = JSON.parse("{}")
        var OrderID;
        if(getParameter("id")){
            OrderID = getParameter("id");
            OrderInfo.OrderID = OrderID;
            localStorage.OrderInfo = JSON.stringify(OrderInfo) ;
            //alert(localStorage.sellerInfo);
        }else {
            window.location.href="myOrderList.html";
        }


        var userPosition ;
        if(localStorage.userPosition){
            userPosition = localStorage.userPosition;
            /*接口调用*/
            po('user','getorderlist',{"UserID":userInfo.UserID,"OrderID":OrderInfo.OrderID,"UserPosition":userPosition,"SellerID":""},"getorderlistcallback");
        }else{
            /*获取位置信息*/
            var geolocation = new BMap.Geolocation();
            var userPosition = "116.404|39.915";
            geolocation.getCurrentPosition(function(r){
                if(this.getStatus() == BMAP_STATUS_SUCCESS){
                    //alert('您的位置：'+r.point.lng+','+r.point.lat);
                    userPosition = r.point.lng+"|"+r.point.lat;
                    localStorage.UserPosition = userPosition;
                }
                else {
                    if(localStorage.userPosition){
                        userPosition = "116.404|39.915";
                    }
                }
                /*接口调用*/
                po('user','getorderlist',{"UserID":userInfo.UserID,"OrderID":OrderInfo.OrderID,"UserPosition":userPosition,"SellerID":""},"getorderlistcallback");
            },{enableHighAccuracy: true});
        }




    });

    /*获取订单信息的回调函数*/
    function getorderlistcallback(d)
    {
        //alert(JSON.stringify(d))
        if(d.rd.succ)
        {

            var fl = d.rd.data.orderlist[0];
            if(!fl){
                alert("未找到订单信息！");
               window.location.href="myOrderList.html";
            }

            if(fl.OrderStatus=="1"){
                fl.OrderStatus="已送达";
            }else{
                fl.OrderStatus="未送达";
            }
//            alert(JSON.stringify(fl))
            //保存到本地缓存
            localStorage.OrderInfo = JSON.stringify(fl);
            //alert(localStorage.sellerInfo );
            // 附上模板
            $("#result1").setTemplateElement("template");
            // 给模板加载数据
            $("#result1").processTemplate(fl);	/*d.rd.data.sellerlist*/
        }
    }
</script>
<body id="result1">
<textarea id="template" style="display:none">
    <header>
        <div class="select-back">
            <a href="myOrderList.html" id="back">
                <span  class="back-icon"></span><br>
                返回
            </a>
        </div>
        订单信息
        <div class="book">
            <a href="speak.html?id={$T.OrderID}" class="speak-icon"></a>
        </div>
    </header>
    <main class="activity-detail" >
        <div class="detail">

            <ul>
                <li class="first"><span>订单编码</span><span class="margin-rightNon">{$T.OrderID}</span></li>
                <li ><span>产品名称</span><span class="margin-rightNon">{$T.PrdName}</span></li>
                <li ><span>订单人姓名</span><span class="margin-rightNon">{$T.Owner}</span></li>
                <li><span>数量</span><span class="margin-rightNon">{$T.OCount} </span></li>
                <li><span>预约日期</span><span class="margin-rightNon">{$T.OrderDate} </span></li>
                <li><span>预计到达时间</span><span class="margin-rightNon">{$T.ArriveDate} </span></li>
                <li><span>是否上门</span><span class="margin-rightNon">{$T.ComeFlag} </span></li>
                <li><span>地址区域</span><span class="margin-rightNon">{$T.R1} </span></li>
                <li><span>详细地址</span><span class="margin-rightNon">{$T.Address} </span></li>
                <li><span>详细要求</span><span class="margin-rightNon">{$T.Requirement} </span></li>
                <li><span>联系电话</span><span class="margin-rightNon">{$T.Tel} </span></li>
                <li><span>订单状态</span><span class="margin-rightNon">{$T.OrderStatus} </span></li>
            </ul>
        </div>

    </main>
</textarea>
</body>
</html>