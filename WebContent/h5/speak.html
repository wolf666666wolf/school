<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-densitydpi" />
    <title>我有话说</title>
    <link rel="stylesheet" href="css/common.css">
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/self-menu.js"></script>

    <script src="./js/pageCommon.js"></script>
    <script type="text/javascript" src="js/quo.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery-jtemplates.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
</head>
<style>
     main.leave-message .nicknamesp{display: inline-block;margin-right: 45px;}
</style>
<script>
    var OrderID;
    $(function(){
  // alert(localStorage.userinfo);
        //页面加载的一些处理
        $(".dropdownList").hide().attr("status","0");

//        alert(getParameter("id"))
        if(localStorage.userinfo==undefined){
            window.location.href = "bind-mine.html";
        }
        var userInfo = JSON.parse(localStorage.userinfo);
//        alert(userInfo.NickName)
       $("#username").html( userInfo.NickName);
        if(getParameter("id").trim()!=""){
            OrderID = getParameter("id");
            $("#back").attr("href","order-info.html?id="+OrderID);
        }else{
            window.location.href="myOrderList.html";
        }



        //获取位置信息
        var geolocation = new BMap.Geolocation();
        var userPosition = "116.404|39.915"
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                //alert('您的位置：'+r.point.lng+','+r.point.lat);
                userPosition = r.point.lng+"|"+r.point.lat;
                localStorage.UserPosition = userPosition;
            }
            else {
                if(localStorage.userPosition){
                    userPosition = localStorage.userPosition
                }
            }
        },{enableHighAccuracy: true});


        /*提交表单*/
        $("#subassess").click(function() {
            if($("#Title").val()==""){alert("请填写标题!");return;}
            if($("#Content").val()==""){alert("请填写留言内容!");return;}
            var data = {
                "UserPosition":userPosition,//用户位置
                "UserID": userInfo.UserID,//用户编码
                "OrderID":OrderID,//订单编码
                "Title": $("#Title").val(),//标题
                "Level": $("#Level").val(),////留言类型，数字1到5
                "Community": $("#Community").val(),//社区
                "Content": $("#Content").val(),//内容
                "Phone": $("#Phone").val()//电话
            };
            po('product', 'assess', data, "assesscallback");
            $(this).attr("disabled",true);
        });

        /*下拉按钮点击*/
        $(".dropdown").find("a").click(function(){
            var status = $(this).parent().find(".dropdownList").attr("status");
            if(status=="0"){
                $(this).parent().find(".dropdownList").show().attr("status","1");
            }
            if(status=="1"){
                $(this).parent().find(".dropdownList").hide().attr("status","0");
            }
        });
        /*下拉列表选中*/
        $(".dropdown").find(".dropdownList>ul>li").click(function(){
            var outer =  $(this).parent().parent().parent();
            outer.find("input").val($(this).html());
            outer.attr("Level",$(this).attr("Level"));
            $(this).parent().parent().hide().attr("status","0");
        });
    });

    /*提交评价的回调函数*/
    function assesscallback(d){
        //alert(JSON.stringify(d))
        if(d.rd.succ){
//        alert(d.rd.msg)
            alertMsg("main",d.rd.msg,"50%","0%","#374F87","0.8em","10%");
            $("#subassess").attr("disabled",false);
            setTimeout(function(){
                window.location.href="order-info.html?id="+OrderID;
            },800);

        }else{
            alert(d.rd.msg);
            $("#subassess").attr("disabled",false);
        }
    }

</script>
<body>
<div class="container"></div>
<header>
    <div class="select-back">
        <a href="javascript:history.go(-1)" id="back">
            <span  class="back-icon"></span><br>
            返回
        </a>
    </div>
    评价
</header>
<main class="leave-message">

    <form  action="" method="">
        <div class="txt-center">
            <div class="item">
                <span>标题*</span>
            </div>
            <input id="Title" type="text"  >
            <div class="item border-bottom">
                <span class="nicknamesp">姓名或昵称</span>
                <span id="username" class="rightsp">xxx</span>
            </div>

            <div class="item">
                <span>留言类型</span>
            </div>
            <!--TODO-->
            <div class="inputDiv dropdown" id="Level" Level="1">
                <input type="text"  value="预订问题" disabled="disabled">
                <a></a>
                <div class="dropdownList">
                    <ul>
                        <li Level="1">预订问题</li>
                        <li Level="2">政策法规</li>
                        <li  Level="3">订水</li>
                        <li  Level="4">订车</li>
                        <li  Level="5">医院挂号</li>
                    </ul>
                </div>
            </div>

            <!--TODO-->
            <div class="item">
                <span class="form-title">社区</span>
            </div>
            <!--TODO-->
            <input type="text" id="Community" style="width: 100%" placeholder="请填写社区">
            <!--TODO-->
        </div>

        <div class="item"><span>内容*</span></div>
        <textarea id="Content"></textarea>
        <div class="item">
            <span>我的电话</span>
        </div>
        <input id="Phone" type="text"  placeholder="+86">

        <a id="subassess" class="sub-book"></a>

    </form>
</main>



</body>
</html>