<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-densitydpi" />
    <title>个人中心</title>
    <link rel="stylesheet" href="css/common.css">
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/self-menu.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/jquery-jtemplates.js"></script>
    <script src="./js/pageCommon.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
</head>
<script>
$(function(){
    if(!localStorage.userinfo){
        window.location.href = "bind-mine.html";
    }
    var userInfo = JSON.parse(localStorage.userinfo);
    var userPosition ;
    if(localStorage.userPosition){
        userPosition = localStorage.userPosition;
        /*接口调用*/
        po('user','getcenter',{"UserID":userInfo.UserID,"UserPosition":userPosition},"getcentercallback");
    }else{
        /*获取位置信息*/
        var geolocation = new BMap.Geolocation();
        var userPosition = "116.404|39.915";
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                //alert('您的位置：'+r.point.lng+','+r.point.lat);
                userPosition = r.point.lng+"|"+r.point.lat;
                localStorage.UserPosition = userPosition;
            }
            else {
                if(localStorage.userPosition){
                    userPosition = "116.404|39.915";
                }
            }
            /*接口调用*/
            po('user','getcenter',{"UserID":userInfo.UserID,"UserPosition":userPosition},"getcentercallback");
        },{enableHighAccuracy: true});
    }





});
/*获取商家信息的回调函数*/
function getcentercallback(d)
{
    //alert(JSON.stringify(d))
    if(d.rd.succ)
    {

        var datearr =  d.rd.data.LastLoginDate.split("-")
        d.rd.data.LastLoginDate = datearr[0]+"年"+datearr[1]+"月"+datearr[2]+"日";

        datearr =  d.rd.data.NowDate.split("-")
        d.rd.data.NowDate = datearr[0]+"年"+datearr[1]+"月"+datearr[2]+"日";
        //保存到本地缓存
//        localStorage.prdInfo = JSON.stringify(d.rd.data);
        //alert(localStorage.sellerInfo );
        if(!d.rd.data.c1.trim()){//下单次数
            d.rd.data.c1="--";
        }
        if(!d.rd.data.c2.trim()){//成功订单
            d.rd.data.c2="--"
        }
        if(!d.rd.data.c3.trim()){//未完成订单
            d.rd.data.c3="--"
        }
        if(!d.rd.data.c4.trim()){//取消订单
            d.rd.data.c4="--"
        }
        if(!d.rd.data.c5.trim()){//评论次数
            d.rd.data.c5="--"
        }
        if(!d.rd.data.c6.trim()){//参加活动次数
            d.rd.data.c6="--"
        }
        // 附上模板
        $("#result1").setTemplateElement("template");
        // 给模板加载数据
        $("#result1").processTemplate(d.rd.data);	/*d.rd.data.sellerlist*/


    }
}
</script>
<style>

</style>
<body>

<header>
    个人中心
</header>
<div class="self-menu">
    <div id="menu" class="menu">
        <ul>
            <li class="first-item selected" style="margin-left: 1%"><a href="#">我的中心</a></li>
            <li><a href="my-info.html">个人信息</a></li>
            <li class="right-border0" style="margin-right: 1%"><a href="myOrderList.html">订单信息</a></li>
            <li class="margin-left" style="margin-left: 1%"><a href="myactivity.html">我的活动</a></li>
            <li><a href="mysave.html">我的收藏</a></li>
            <li class="right-border0" style="margin-right: 1%"><a href="mylike.html">我的关注</a></li>
        </ul>
    </div>
    <div class="move-left" id="moveleft"><a ></a></div>
    <div class="move-right" id="moveright"><a ></a></div>
</div>
<main class="selfzoom" id="result1">
    <textarea id="template" style="display:none">
    <div class="detail">
        <div class="welcome">
            今天是{$T.NowDate}&nbsp;&nbsp;&nbsp;星期{$T.NowDay}&nbsp;&nbsp;&nbsp;{$T.UserName}&nbsp;&nbsp;&nbsp;您好
        </div>
        <ul>
            <li class="first"><span>上次登录时间</span><span class="margin-rightNon">{$T.LastLoginDate}</span></li>
            <li class="paddign-top50"><span>下单次数</span><span class="date margin-rightNon" >{$T.c1}次</span></li>
            <li><span>成功订单</span><span class="margin-rightNon">{$T.c2}次</span></li>
            <li><span>未完成订单</span><span class="margin-rightNon">{$T.c3}次</span></li>
            <li><span>取消订单</span><span class="margin-rightNon">{$T.c4}次</span></li>
            <li class="paddign-top50">
                <span>评论发言</span>
                <span class="margin-rightNon">{$T.c5}次</span>
            </li>
            <li class="border-top2"><span>参加活动</span><span class="margin-rightNon">{$T.c6}次</span></li>
            <li class="last-item border-top2"></li>
        </ul>
    </div>

</textarea>
</main>
<footer>
    <ul>
        <li class="side-item"></li>
        <li>
            <a  href="activities.html">
                <span class="button-icon activity-icon"></span>
            </a>
        </li>
        <li>
            <a  href="busines.html">
                <span class="button-icon business-icon"></span>
            </a>
        </li>
        <li>
            <a class="selected"  href="selfzoom.html">
                <span class="button-icon selfzoom-icon"></span>
            </a>
        </li>
        <li class="side-item"></li>
    </ul>
</footer>
<script>
    $(function () {
        $(window).scroll(function () {
            $("footer").animate({bottom: "0"}, "fast");
        });
    });
</script>

</body>
</html>